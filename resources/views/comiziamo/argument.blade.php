<style type="text/css">
  
#table_argument.table {
  border-spacing: 0 0.85rem !important;
}

#table_argument.table .dropdown {
  display: inline-block;
}

#table_argument.table td,
#table_argument.table th {
  vertical-align: middle;
  margin-bottom: 10px;
  border: none;
}

#table_argument.table thead tr,
#table_argument.table thead th {
  border: none;
  font-size: 12px;
  letter-spacing: 1px;
  text-transform: uppercase;
  background: transparent;
}

#table_argument.table td {
  background: #fff;
}

#table_argument.table td:first-child {
  border-top-left-radius: 10px;
  border-bottom-left-radius: 10px;
}

#table_argument.table td:last-child {
  border-top-right-radius: 10px;
  border-bottom-right-radius: 10px;
}

#table_argument.avatar {
  width: 2.75rem;
  height: 2.75rem;
  line-height: 3rem;
  border-radius: 50%;
  display: inline-block;
  background: transparent;
  position: relative;
  text-align: center;
  color: #868e96;
  font-weight: 700;
  vertical-align: bottom;
  font-size: 1rem;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

#table_argument.avatar-sm {
  width: 2.5rem;
  height: 2.5rem;
  font-size: 0.83333rem;
  line-height: 1.5;
}

#table_argument.avatar-img {
  width: 100%;
  height: 100%;
  -o-object-fit: cover;
  object-fit: cover;
}

#table_argument.avatar-blue {
  background-color: #c8d9f1;
  color: #467fcf;
}

table#table_argument.dataTable.dtr-inline.collapsed
  > tbody
  > tr[role="row"]
  > td:first-child:before,
table#table_argument.dataTable.dtr-inline.collapsed
  > tbody
  > tr[role="row"]
  > th:first-child:before {
  top: 28px;
  left: 14px;
  border: none;
  box-shadow: none;
}

table#table_argument.dataTable.dtr-inline.collapsed > tbody > tr[role="row"] > td:first-child,
table#table_argument.dataTable.dtr-inline.collapsed > tbody > tr[role="row"] > th:first-child {
  padding-left: 48px;
}

table#table_argument.dataTable > tbody > tr.child ul.dtr-details {
  width: 100%;
}

table#table_argument.dataTable > tbody > tr.child span.dtr-title {
  min-width: 50%;
}

table#table_argument.dataTable.dtr-inline.collapsed > tbody > tr > td.child,
table#table_argument.dataTable.dtr-inline.collapsed > tbody > tr > th.child,
table#table_argument.dataTable.dtr-inline.collapsed > tbody > tr > td.dataTables_empty {
  padding: 0.75rem 1rem 0.125rem;
}

div#table_argument.dataTables_wrapper div.dataTables_length label,
div#table_argument.dataTables_wrapper div.dataTables_filter label {
  margin-bottom: 0;
}

@media (max-width: 767px) {
  div#table_argument.dataTables_wrapper div.dataTables_paginate ul.pagination {
    -ms-flex-pack: center !important;
    justify-content: center !important;
    margin-top: 1rem;
  }
}

.dataTables_wrapper .dataTables_filter input {
    margin-left: 0;
}

#table_argument.btn-icon {
  background: #fff;
}
#table_argument.btn-icon .bx {
  font-size: 20px;
}

#table_argument.btn .bx {
  vertical-align: middle;
  font-size: 20px;
}

#table_argument.dropdown-menu {
  padding: 0.25rem 0;
}

#table_argument.dropdown-item {
  padding: 0.5rem 1rem;
}

#table_argument.badge {
  padding: 0.5em 0.75em;
}

#table_argument.badge-success-alt {
  background-color: #d7f2c2;
  color: #7bd235;
}

#table_argument.table a {
  color: #212529;
}

#table_argument.table a:hover,
#table_argument.table a:focus {
  text-decoration: none;
}

table#table_argument.dataTable {
  margin-top: 12px !important;
}

#table_argument.icon > .bx {
  display: block;
  min-width: 1.5em;
  min-height: 1.5em;
  text-align: center;
  font-size: 1.0625rem;
}

#table_argument.btn {
  font-size: 0.9375rem;
  font-weight: 500;
  padding: 0.5rem 0.75rem;
}

#table_argument.avatar-blue {
  background-color: #c8d9f1;
  color: #467fcf;
}

#table_argument.avatar-pink {
  background-color: #fcd3e1;
  color: #f66d9b;
}

.paginate_button{
  color: #fff;
  background-color: #6c757d;
  border-color: #6c757d;
  padding: 0!important;
  display: inline-block;
  font-weight: 400;
  text-align: center;
  vertical-align: middle;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  font-size: 1rem;
  line-height: 1.5;
  border-radius: .25rem;
  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;
}


.pagination{
  float: right !important;
}

.page-item.active .page-link {
    z-index: 3;
    color: #fff;
    background-color: #6c757d!important;
    border-color: #6c757d!important;
}

.disabled {
  pointer-events: none;
  cursor: default;
  background: lightgray!important;
}

/*style + sul cell*/
.dtr-control:before{

  top: 50%!important;

}
/*style button circle plus*/
.btn-circle {
  width: 50px!important;
  height: 50px!important;
  padding: 6px 0px;
  border-radius: 25px!important;
  text-align: center;
  font-size: 12px;
  line-height: 1.42857;
}

/*style arrow toggle*/
.rotate {
    transform: rotate(-180deg);
    /*transform: rotate(180deg);*/
    transition: .3s;
}
.rotate2 {
    transform: rotate(0deg);
    transition: .3s;
}
/*style error empty form*/
.error{
        outline: 1px solid red;
        border-radius: .25rem;
    }    

</style>

<div class="" style="padding: 2rem 1rem; background-color: #e9ecef; border-radius: .3rem;">
  <div class="row">
    <div class="col-md-12">
      <table id="table_argument" class="table table-hover responsive nowrap" style="width:100%">
        <thead>
          <tr>
            <th>@lang('comiziamo/lang.argument')</th>
            <th style="text-align: center;">@lang('comiziamo/lang.state')</th>
            <th style="text-align: center;">@lang('comiziamo/lang.category')</th>
            <th style="text-align: center;">@lang('comiziamo/lang.winner')</th>
            <th style="text-align: center;">@lang('comiziamo/lang.action')</th>
            <th style="text-align: center;">@lang('comiziamo/lang.partecipant')</th>
          </tr>
        </thead>
        <tbody id="append_argument">
        </tbody>
      </table>
    </div>
  </div>
</div>

<script type="text/javascript">

function start_function_argument(){

  get_argument();
  
}

function pad(num) {
  return ("0"+num).slice(-2);
}

function formatDate(date) {
  var d = new Date(date);
  var month = '' + (d.getMonth() + 1);
  var day = '' + d.getDate();
  var year = d.getFullYear();
  var hours = d.getHours();
  var minutes = d.getMinutes();
  var time = pad(hours) + ":" + pad(minutes);
  if (month.length < 2) 
    month = '0' + month;
  if (day.length < 2) 
    day = '0' + day;
  return day+"-"+month+"-"+year;

}


function get_argument(){
  $("#append_argument").empty();
  $.get("/get_argument_comiziamo",{},
   function(data){
    
    var res=jQuery.parseJSON(data);

    var id_user="@if( auth()->guard('users_comiziamo')->check() ){{ auth()->guard('users_comiziamo')->user()->id }}@endif";

    var clock;

    for (var i = 0; i < res.get_argument.length; i++){

      if (res.get_argument[i].state==1) {

        clock="";

      }else{

        clock="clock_"+res.get_argument[i].id;
      }

      
      $("#append_argument").append("<tr>"+

            "<td>"+
              "<a>"+
                "<div class='d-flex align-items-center'>"+
                  "<div class='avatar avatar-blue mr-3' style='text-align: center; '>"+res.get_argument[i].initial_argument+"</div>"+
                  "<div class=''>"+
                    "<p class='font-weight-bold mb-0' style='max-width: 400px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px;' >"+res.get_argument[i].title_argument+"</p>"+
                    "<p class='text-muted mb-0' style='max-width: 400px; word-wrap: break-word; white-space: pre-wrap; font-size: 12px; color:red!important' >Creato da "+res.get_argument[i].created_by+"</p>"+
                  "</div>"+
                "</div>"+
              "</a>"+
            "</td>"+

            "<td style='text-align: center;' id='"+clock+"'><div class='badge color_badge_"+res.get_argument[i].id+"'></div></td>"+

            "<td style='text-align: center;'>"+res.get_argument[i].category_argument+"</td>"+

            "<td style='text-align: center;'>"+res.get_argument[i].winner+"</td>"+

            "<td style='text-align: center;'>"+
              "<div class='dropdown'>"+
                "<button class='btn btn-sm btn-icon' type='button' id='dropdownMenuButton2' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'>"+
                      "<i class='bx bx-hive' data-toggle='tooltip' data-placement='top' title='Actions' style='font-size:1.875rem;'></i>"+
                    "</button>"+
                "<div class='dropdown-menu' aria-labelledby='dropdownMenuButton2'>"+
                  "@if( auth()->guard('users_comiziamo')->check() )"+
                  "<a class='dropdown-item megaphone_"+res.get_argument[i].id+"' onclick='change_vis(\"rally_"+res.get_argument[i].id+"\")'><i class='bx bxs-megaphone mr-2'></i>@lang('comiziamo/lang.comizia')</a>"+
                  "<a class='dropdown-item pencil_"+res.get_argument[i].id+"' onclick='change_vis(\"vote_"+res.get_argument[i].id+"\")'><i class='bx bxs-pencil mr-2' ></i>@lang('comiziamo/lang.vote')</a>"+
                  "<a class='dropdown-item chart_"+res.get_argument[i].id+"' onclick='change_vis(\"chart_"+res.get_argument[i].id+"\")'><i class='bx bx-line-chart mr-2'></i>@lang('comiziamo/lang.exit_pool')</a>"+
                  "@else"+
                  "<a class='dropdown-item' onclick='change_vis(\"login\")'><i class='bx bxs-log-in mr-2'></i>Login/Facebook</a>"+
                  "@endif"+
                "</div>"+
              "</div>"+
            "</td>"+

            "<td style='text-align: center;'>"+res.get_argument[i].partecipant+"</td>"+
            
          "</tr>");


      if (res.get_argument[i].id_user==id_user && res.get_argument[i].partecipant==0) {
        
        $(".chart_"+res.get_argument[i].id).after("<a class='dropdown-item edit_"+res.get_argument[i].id+"' onclick='show_edit_arg(\""+res.get_argument[i].id+"\")'><i class='bx bxs-edit mr-2'></i>@lang('comiziamo/lang.edit')</a><a class='dropdown-item delete_"+res.get_argument[i].id+"' onclick='delete_arg(\""+res.get_argument[i].id+"\",\""+res.get_argument[i].img_arg+"\")'><i class='bx bx-x mr-2'></i>@lang('comiziamo/lang.delete')</a>");

      } 

    }


    open_table_argument();
    get_countdown(res);
    
  }); 

}


function open_table_argument(){
var groupColumn = 2;
$(document).ready(function() {
  $("#table_argument").DataTable({
    "columnDefs": [
    { "visible": false, "targets": groupColumn }
    ],
    "order": [[ groupColumn, 'asc' ]],
    aaSorting: [],
    responsive: true,
    "language": {
    "search": ""
    },
    "displayLength": 10,
    "bPaginate": true,
    "bLengthChange": false,
    "bFilter": true,
    "bInfo": true,
    "bAutoWidth": false,
    "drawCallback": function ( settings ) {
      var api = this.api();
      var rows = api.rows( {page:'current'} ).nodes();
      var last=null;

      api.column(groupColumn, {page:'current'} ).data().each( function ( group, i ) {
        if ( last !== group ) {
          $(rows).eq( i ).before(
            '<tr class="group"><td colspan="6" style="background-color:#6c757d;color:white;">'+group+'</td></tr>'
            );

          last = group;
        }
      } );
    },

    "initComplete": function(settings, json) {

    }

  });

  $('#table_argument tbody').on( 'click', 'tr.group', function () {
        var currentOrder = table.order()[0];
        if ( currentOrder[0] === groupColumn && currentOrder[1] === 'asc' ) {
            table.order( [ groupColumn, 'desc' ] ).draw();
        }
        else {
            table.order( [ groupColumn, 'asc' ] ).draw();
        }
    } );

  var form_add_argument=`<div id="form_add_argument" class="card col-md-12 mb-3 mt-3" style="display: none;">
  <div class="card-body">
    <h6 class="d-flex align-items-center mb-3"><i class="material-icons text-info">@lang('comiziamo/lang.add_argument')</h6></i>
    <div class="row append_sub_category">
      <div class="col-sm-3" style="padding-top: 10px; padding-bottom: 10px;">
      <h6 style="text-align: left;" class="mb-0">@lang('comiziamo/lang.category') <br></h6>
      </div>
      <div class="col-sm-9">
        <div class="form-group">
          <select class="form-control" name="category_argument" id="category_argument">
            <option value="1">@lang('comiziamo/lang.choose_argument')</option>
            <option value="@lang('comiziamo/lang.politic')">@lang('comiziamo/lang.politic')</option>
            <option value="@lang('comiziamo/lang.economy')">@lang('comiziamo/lang.economy')</option>
            <option value="@lang('comiziamo/lang.environment')">@lang('comiziamo/lang.environment')</option>
            <option value="@lang('comiziamo/lang.health')">@lang('comiziamo/lang.health')</option>
            <option value="@lang('comiziamo/lang.technology')">@lang('comiziamo/lang.technology')</option>
            <option value="@lang('comiziamo/lang.sport')">@lang('comiziamo/lang.sport')</option>
            <option value="@lang('comiziamo/lang.culture')">@lang('comiziamo/lang.culture')</option>
            <option value="@lang('comiziamo/lang.world')">@lang('comiziamo/lang.world')</option>
          </select>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3" style="padding-top: 10px; padding-bottom: 10px;">
      <h6 style="text-align: left;" class="mb-0">@lang('comiziamo/lang.initial_argument') <br><span class="initial_argument"></span></h6>
      </div>
      <div class="col-sm-9 mb-3">
      <input type="text" class="form-control sam_notes" name="initial_argument" id="initial_argument" placeholder="@lang('comiziamo/lang.initial_argument')" value="" maxlength="2">
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3" style="padding-top: 10px; padding-bottom: 10px;">
      <h6 style="text-align: left;" class="mb-0">@lang('comiziamo/lang.title_argument') 
      <br><span class="title_argument"></span></h6>
      </div>
      <div class="col-sm-9 mb-3">
      <input type="text" class="form-control sam_notes" name="title_argument" id="title_argument"  placeholder="@lang('comiziamo/lang.title_argument') " value="" maxlength="50">
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3" style="padding-top: 10px; padding-bottom: 10px;">
      <h6 style="text-align: left;" class="mb-0">@lang('comiziamo/lang.image_argument') <br><span class="image_argument"></span></h6>
      </div>
      <div class="col-sm-9 mb-3">
        <input type="file" name="image-file" id="argument_upload" onchange="previewFile_argument(event)" style="opacity: 0;display: none">
        <div onclick="$('#argument_upload').trigger('click'); return false;">
          <img id="image_argument" src="uploads/default_img.png?refresh=<?php echo rand(1,999); ?>" alt="Admin" class="" width="" height="200" style="width: 100%; object-fit: cover;">
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3" style="padding-top: 10px; padding-bottom: 10px;">
      <h6 style="text-align: left;" class="mb-0">@lang('comiziamo/lang.description_argument')  <br><span class="description_argument"></span></h6>
      </div>
      <div class="col-sm-9 mb-3">
      <textarea maxlength="500" class="form-control sam_notes" name="description_argument" id="description_argument" placeholder="@lang('comiziamo/lang.place_description_argument')" value=""></textarea>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3" style="padding-top: 10px; padding-bottom: 10px;">
      <h6 style="text-align: left;" class="mb-0">@lang('comiziamo/lang.date_end_rally')</h6>
      </div>
      <div class="col-sm-9 mb-3">
      <input type="date" class="form-control" name="date_rally" id="date_rally" placeholder="@lang('comiziamo/lang.date_end_rally')" value="">
      </div>
    </div>
    
    <p style="float: right; padding-top: 15px;">
    <a id="button_send_edit_arg" class="btn btn-secondary" target="_blank" role="button" onclick="check_form_argument('send')">@lang('comiziamo/lang.send') <i class="fa fa-chevron-right" aria-hidden="true"></i>
    </a>
    </p>
    </div>
  </div>`;


  $(".dataTables_filter input").attr("placeholder", "@lang('comiziamo/lang.search_arg_user_winner')");
  var level_user="@if( auth()->guard('users_comiziamo')->check() ){{auth()->guard('users_comiziamo')->user()->level}}@endif";
  //cambiare segno operatore per vedere aggiungi argomento

 
  if (level_user<=10) {
    var send="send";
    $(".dataTables_filter label").before('<p id="button_add" class="row col-md-12 mb-3" style="margin: 0; padding: 0;">'+
    '<a  class="btn btn-secondary" target="_blank" role="button" onclick="action_arrow(\''+send+'\')" ">@lang("comiziamo/lang.add_argument") <i class="fa fa-arrow-down arrow-img rotate2" aria-hidden="true"></i>'+
    '</a>'+
  '</p>');
  }
  
  $(".dataTables_filter label").addClass("row col-md-12").css({"margin": 0, "padding": 0});
  $("#button_add").after(form_add_argument);
  $(".dataTables_filter").css({
      "display": "contents",
    });
  $(".dataTables_filter").parent().removeClass("col-md-6");
  $(".dataTables_filter input").addClass("form-control");
  set_data_current();

});

}




function get_countdown(res){

  var id_user="@if( auth()->guard('users_comiziamo')->check() ){{ auth()->guard('users_comiziamo')->user()->id }}@endif";

  for (var i = 0; i < res.get_argument.length; i++) {

    if (res.get_argument[i].partecipant==0 && res.get_argument[i].timer_start_rally=="0000-00-00" && res.get_argument[i].total_vote==0 && res.get_argument[i].state==1){

      $(".color_badge_"+res.get_argument[i].id).addClass("badge-danger badge-danger-alt");
      $(".color_badge_"+res.get_argument[i].id).text("@lang('comiziamo/lang.close')");
      $(".megaphone_"+res.get_argument[i].id).addClass("disabled");
      $(".pencil_"+res.get_argument[i].id).addClass("disabled");
      $(".chart_"+res.get_argument[i].id).addClass("disabled");


    }else{

      if (res.get_argument[i].timer_start_rally=="0000-00-00") {
        $(".color_badge_"+res.get_argument[i].id).addClass("badge-danger badge-danger-alt");
        $(".color_badge_"+res.get_argument[i].id).text("@lang('comiziamo/lang.close')");
        $(".megaphone_"+res.get_argument[i].id).addClass("disabled");
        $(".pencil_"+res.get_argument[i].id).addClass("disabled");
        $(".chart_"+res.get_argument[i].id).removeClass("disabled");
        var result="show_chart";

      }else if(res.get_argument[i].partecipant==0){

        timedown(res.get_argument[i].timer_start_rally,'clock_'+res.get_argument[i].id, res);
        var result="show_rally";

        $(".megaphone_"+res.get_argument[i].id).removeClass("disabled");
        $(".pencil_"+res.get_argument[i].id).addClass("disabled");
        $(".chart_"+res.get_argument[i].id).addClass("disabled");

        
      }else if(res.get_argument[i].total_vote==0){

        timedown(res.get_argument[i].timer_start_rally,'clock_'+res.get_argument[i].id, res);
        var result="show_rally";

        $(".megaphone_"+res.get_argument[i].id).removeClass("disabled");
        $(".pencil_"+res.get_argument[i].id).removeClass("disabled");
        $(".chart_"+res.get_argument[i].id).addClass("disabled");

      }else{

        timedown(res.get_argument[i].timer_start_rally,'clock_'+res.get_argument[i].id, res);
        var result="show_rally";

        $(".megaphone_"+res.get_argument[i].id).removeClass("disabled");
        $(".pencil_"+res.get_argument[i].id).removeClass("disabled");
        $(".chart_"+res.get_argument[i].id).removeClass("disabled");
      }
    }
  
  }

  for (var y = 0; y < res.get_argument_partecipant_user.length; y++) {

      if(res.get_argument_partecipant_user[y].id_user==id_user && res.get_argument_partecipant_user[y].vote!=0){

        $(".megaphone_"+res.get_argument_partecipant_user[y].id_arg).addClass("disabled");

      }else{
        $(".chart_"+res.get_argument_partecipant_user[y].id_arg).removeClass("disabled");

      }
    }

}


function timedown(ti,id,res){

var countDownDate = new Date(ti).getTime();

var x = setInterval(function() {

    var now = new Date().getTime();
    
    var distance = countDownDate - now;
    
    var days = Math.floor(distance / (1000 * 60 * 60 * 24));
    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = Math.floor((distance % (1000 * 60)) / 1000);

    $("#"+id).text((days!=0 ? days + ":" : '') + (hours!= 0 ? hours + ":" : '')
    + (minutes != 0 ? minutes + ":" : '') + seconds + "");

    if (distance < 0) {

        clearInterval(x);

        $("#"+id).replaceWith('<td style="text-align: center;" id=""><div class="badge color_badge_'+id+' badge-danger badge-danger-alt">@lang("comiziamo/lang.close")</div></td>');
        
        var split_id=id.split("_")[1];

        $.get("/reset_time_comiziamo",{split_id:split_id},
         function(data){
          
          var res2=jQuery.parseJSON(data);

          if (res2.get_argument.length==0) {

            location.reload();

          }

          get_countdown(res2);

        });

    }
}, 1000);
}


function set_data_current(){


  $( "#category_argument" ).change(function() {

    if ($("#category_argument").val()=="@lang('comiziamo/lang.challenge')") {

      var append_challenge_cat=`<div class="row challenge_cat">
          <div class="col-sm-3" style="padding-top: 10px; padding-bottom: 10px;">
          <h6 style="text-align: left;" class="mb-0">@lang('comiziamo/lang.challenge') <br></h6>
          </div>
          <div class="col-sm-9">
            <div class="form-group">
              <select class="form-control" name="category_challenge" id="category_challenge">
                <option value="0">@lang('comiziamo/lang.choose_challenge')</option>
                <option value="1_1">@lang('comiziamo/lang.sing')</option>
                <option value="2_2">@lang('comiziamo/lang.art')</option>
                <option value="3_3">@lang('comiziamo/lang.dance')</option>
              </select>
            </div>
          </div>
        </div>`;
    
    $(".append_sub_category").after(append_challenge_cat);

    }else{

      $(".challenge_cat").remove();

    }

    
  });

  var tomorrow=new Date();

  tomorrow.setDate(tomorrow.getDate()+1);

  var dt = tomorrow.getFullYear() + '-' + ("0" + (tomorrow.getMonth() + 1)).slice(-2) + '-' + ("0" + tomorrow.getDate()).slice(-2);

  $('#date_rally').attr('min' , dt);

  $('#date_rally').change(function(){

    var post_year_date=$('#date_rally').val().split("-")[0];
    var post_month_date=$('#date_rally').val().split("-")[1];
    var post_day_date=("0" + $('#date_rally').val().split("-")[2]).slice(-2);
    var complete_date=post_year_date+"-"+post_month_date+"-"+post_day_date;

    var day_after_tomorrow = new Date(complete_date);

    day_after_tomorrow.setDate(day_after_tomorrow.getDate()+1);

    var dat = day_after_tomorrow.getFullYear() + '-' + ("0" + (day_after_tomorrow.getMonth() + 1)).slice(-2) + '-' + ("0" + day_after_tomorrow.getDate()).slice(-2);


  });

}


function action_arrow(from){
  
  $('.arrow-img').toggleClass('rotate');
  $('.arrow-img').toggleClass('rotate2');
  if ($('.arrow-img').hasClass('rotate')) {
    $("#form_add_argument").show();
  }else{
    $("#form_add_argument").hide();
  }
  if (from=="send") {

      $(".text-info").text("@lang('comiziamo/lang.add_argument')");

      var id_user="@if( auth()->guard('users_comiziamo')->check() ){{auth()->guard('users_comiziamo')->user()->level}}@endif";

      if (id_user!="") {
        $("#button_send_edit_arg").attr("onclick","check_form_argument('send')").text("@lang('comiziamo/lang.add')");
      }else{
        $("#button_send_edit_arg").attr("onclick","change_vis('login')").text("@lang('comiziamo/lang.add')");
      }

      $("#form_add_argument").find('input').val("");
      $("#form_add_argument").find('textarea').val("");
      $("#category_argument").val("1");
      $("#image_argument").attr("src","uploads/default_img.png?refresh=<?php echo rand(1,999); ?>");

    }
};



function previewFile_argument(event) {

  var reader = document.getElementById('image_argument');
    reader.src = URL.createObjectURL(event.target.files[0]);
    reader.onload = function() {
      URL.revokeObjectURL(reader.src) // free memory
    }

}


function check_form_argument(from, id_arg){

  $("#form_add_argument .form-control").each(function(index){

    if ($(this).val()=="" || $(this).val()==1) {

      $(this).css("border-color","red");

    } else{

      $(this).css("border-color","black");

      $(this).addClass("border_black");

    }
    
  });

  if ($(".border_black").length==$("#form_add_argument .form-control").length) {

    if (from=="send") {

      send_add_argument();

    }else{

      edit_add_argument(id_arg);

    }

  }

}

function send_add_argument(){

  var files=$('#argument_upload')[0].files[0];
  var ext_file=files.name.split(".")[1];

  var category_argument=$("#category_argument").val();
  var category_challenge=$("#category_challenge").val();
  var initial_argument=$("#initial_argument").val().toUpperCase();
  var title_argument=$("#title_argument").val();
  var description_argument=$("#description_argument").val();
  var date_rally=$("#date_rally").val();

  $.get('/send_add_argument_comiziamo', {category_argument:category_argument, category_challenge:category_challenge, initial_argument:initial_argument, title_argument:title_argument, description_argument:description_argument, date_rally:date_rally},
    function(data){


     const formData = new FormData();
     formData.append('file',files, files.name);
     formData.append('id_arg', data);
     formData.append('ext_file', ext_file);

     setTimeout(function(){
      $.ajax({
        url : "comiziamo/upload_img_argument.php",
        type: 'POST',
        data : formData,
        processData: false, 
        contentType: false,  
        cache:false,
        success : function(file_name) {
          $.get("/upload_img_argument_comiziamo",{id_arg:data,file_name:file_name},
            function(data){

              action_arrow();
              $('#category_argument option[value=1]').attr('selected','selected');
              $("#form_add_argument").find('input').val("");
              $("#form_add_argument").find('textarea').val("");
              $("#table_argument").DataTable().destroy();
              start_function_argument();

            });

        },
        error: function (data, textStatus, errorThrown) {

        },
      });
    },2000);

   });

}

function show_edit_arg(id_arg){
  $(".text-info").text("@lang('comiziamo/lang.edit_argument')");
  $("#button_send_edit_arg").attr("onclick","check_form_argument('edit',\""+id_arg+"\")").text("@lang('comiziamo/lang.edit')")

  if (!$('.arrow-img').hasClass('rotate')) {
    action_arrow();
  } 
  $("html, body").animate({ scrollTop: 0 }, "slow");
  $.get('/show_edit_arg_comiziamo', {id_arg:id_arg},
    function(data){ 
      var res=jQuery.parseJSON(data);
      for (var i = 0; i < res.length; i++) {
        // $('#category_argument option[value='+res[i].category_argument+']').attr('selected','selected');
        $('#category_argument').val(res[i].category_argument);
        $("#initial_argument").val(res[i].initial_argument);
        $("#title_argument").val(res[i].title_argument);
        if (res[i].img_arg=="") {
          $("#image_argument").attr("src","uploads/default_img.png?refresh=<?php echo rand(1,999); ?>");
        }else{
          $("#image_argument").attr("src","uploads/img_argument/"+res[i].img_arg);
        }
        $("#description_argument").val(res[i].argument);
        $("#date_rally").val(res[i].timer_start_rally);
       

      }
     
    });
}

function edit_add_argument(id_arg){

  var files=$('#argument_upload')[0].files[0];
  var ext_file=files.name.split(".")[1];

  var category_argument=$("#category_argument").val();
  var category_challenge=$("#category_challenge").val();
  var initial_argument=$("#initial_argument").val().toUpperCase();
  var title_argument=$("#title_argument").val();
  var description_argument=$("#description_argument").val();
  var date_rally=$("#date_rally").val();


  $.get('/edit_add_argument_comiziamo', {id_arg:id_arg,category_argument:category_argument, category_challenge:category_challenge, initial_argument:initial_argument, title_argument:title_argument, description_argument:description_argument, date_rally:date_rally},
    function(data){ 


      const formData = new FormData();
      formData.append('file',files, files.name);
      formData.append('id_arg', id_arg);
      formData.append('ext_file', ext_file);

      setTimeout(function(){
        $.ajax({
          url : "upload_img_argument.php",
          type: 'POST',
          data : formData,
          processData: false, 
          contentType: false,  
          cache:false,
          success : function(file_name) {
            $.get("/upload_img_argument_comiziamo",{id_arg:id_arg,file_name:file_name},
              function(data){

               $('#category_argument option[value=1]').attr('selected','selected');
               $("#form_add_argument").find('input').val("");
               $("#form_add_argument").find('textarea').val("");

               location.reload();

             });

          },
          error: function (data, textStatus, errorThrown) {

          },
        });
      },2000);

    });
}

function delete_arg(id_arg, img_arg){

  $.get('/delete_arg_comiziamo', {id_arg:id_arg, img_arg:img_arg},
    function(data){ 
        $("#table_argument").DataTable().destroy();
        start_function_argument();
      });

}





</script>
